{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { ref } from 'vue';\nimport { useRouter } from 'vue-router';\nconst baseURL = 'http://localhost:8080';\nexport default {\n  __name: 'LoginView',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const username = ref('');\n    const password = ref('');\n    const errorMsg = ref('');\n    const router = useRouter();\n    const handleLogin = async () => {\n      try {\n        errorMsg.value = '';\n        //\n        // LoginController 需要 application/x-www-form-urlencoded 格式\n        const params = new URLSearchParams();\n        params.append('username', username.value);\n        params.append('password', password.value);\n        const response = await fetch(`${baseURL}/login`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n          },\n          body: params\n        });\n\n        // fetch 不会自动抛出 HTTP 错误，需要手动检查\n        if (!response.ok) {\n          throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        const result = await response.json(); //\n\n        if (result.code === 1) {\n          // 登录成功\n          const jwtToken = result.data;\n          localStorage.setItem('jwt-token', jwtToken);\n          // 跳转并刷新\n          router.push('/products').then(() => window.location.reload());\n        } else {\n          // 登录失败\n          errorMsg.value = result.msg || '登录失败。';\n        }\n      } catch (error) {\n        console.error('登录异常:', error);\n        errorMsg.value = '服务器连接失败或响应错误。';\n      }\n    };\n    const __returned__ = {\n      username,\n      password,\n      errorMsg,\n      router,\n      baseURL,\n      handleLogin,\n      ref,\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","useRouter","baseURL","username","password","errorMsg","router","handleLogin","value","params","URLSearchParams","append","response","fetch","method","headers","body","ok","Error","status","result","json","code","jwtToken","data","localStorage","setItem","push","then","window","location","reload","msg","error","console"],"sources":["G:/vue-project/jotang-frontend/src/views/LoginView.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <h2>登录</h2>\r\n    <form @submit.prevent=\"handleLogin\">\r\n      <div>\r\n        <label>用户名: </label>\r\n        <input v-model=\"username\" type=\"text\" required />\r\n      </div>\r\n      <div>\r\n        <label>密码: </label>\r\n        <input v-model=\"password\" type=\"password\" required />\r\n      </div>\r\n      <button type=\"submit\">登录</button>\r\n      <p v-if=\"errorMsg\" style=\"color: red\">{{ errorMsg }}</p>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\n\r\nconst username = ref('');\r\nconst password = ref('');\r\nconst errorMsg = ref('');\r\nconst router = useRouter();\r\nconst baseURL = 'http://localhost:8080';\r\n\r\nconst handleLogin = async () => {\r\n  try {\r\n    errorMsg.value = '';\r\n    //\r\n    // LoginController 需要 application/x-www-form-urlencoded 格式\r\n    const params = new URLSearchParams();\r\n    params.append('username', username.value);\r\n    params.append('password', password.value);\r\n\r\n    const response = await fetch(`${baseURL}/login`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: params\r\n    });\r\n\r\n    // fetch 不会自动抛出 HTTP 错误，需要手动检查\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n\r\n    const result = await response.json(); //\r\n\r\n    if (result.code === 1) {\r\n      // 登录成功\r\n      const jwtToken = result.data;\r\n      localStorage.setItem('jwt-token', jwtToken);\r\n      // 跳转并刷新\r\n      router.push('/products').then(() => window.location.reload());\r\n    } else {\r\n      // 登录失败\r\n      errorMsg.value = result.msg || '登录失败。';\r\n    }\r\n  } catch (error) {\r\n    console.error('登录异常:', error);\r\n    errorMsg.value = '服务器连接失败或响应错误。';\r\n  }\r\n};\r\n</script>"],"mappings":";;;;AAmBA,SAASA,GAAG,QAAQ,KAAK;AACzB,SAASC,SAAS,QAAQ,YAAY;AAMtC,MAAMC,OAAO,GAAG,uBAAuB;;;;;;;IAJvC,MAAMC,QAAQ,GAAGH,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMI,QAAQ,GAAGJ,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMK,QAAQ,GAAGL,GAAG,CAAC,EAAE,CAAC;IACxB,MAAMM,MAAM,GAAGL,SAAS,CAAC,CAAC;IAG1B,MAAMM,WAAW,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI;QACFF,QAAQ,CAACG,KAAK,GAAG,EAAE;QACnB;QACA;QACA,MAAMC,MAAM,GAAG,IAAIC,eAAe,CAAC,CAAC;QACpCD,MAAM,CAACE,MAAM,CAAC,UAAU,EAAER,QAAQ,CAACK,KAAK,CAAC;QACzCC,MAAM,CAACE,MAAM,CAAC,UAAU,EAAEP,QAAQ,CAACI,KAAK,CAAC;QAEzC,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAGX,OAAO,QAAQ,EAAE;UAC/CY,MAAM,EAAE,MAAM;UACdC,OAAO,EAAE;YACP,cAAc,EAAE;UAClB,CAAC;UACDC,IAAI,EAAEP;QACR,CAAC,CAAC;;QAEF;QACA,IAAI,CAACG,QAAQ,CAACK,EAAE,EAAE;UAChB,MAAM,IAAIC,KAAK,CAAC,uBAAuBN,QAAQ,CAACO,MAAM,EAAE,CAAC;QAC3D;QAEA,MAAMC,MAAM,GAAG,MAAMR,QAAQ,CAACS,IAAI,CAAC,CAAC,CAAC,CAAC;;QAEtC,IAAID,MAAM,CAACE,IAAI,KAAK,CAAC,EAAE;UACrB;UACA,MAAMC,QAAQ,GAAGH,MAAM,CAACI,IAAI;UAC5BC,YAAY,CAACC,OAAO,CAAC,WAAW,EAAEH,QAAQ,CAAC;UAC3C;UACAjB,MAAM,CAACqB,IAAI,CAAC,WAAW,CAAC,CAACC,IAAI,CAAC,MAAMC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC,CAAC;QAC/D,CAAC,MAAM;UACL;UACA1B,QAAQ,CAACG,KAAK,GAAGY,MAAM,CAACY,GAAG,IAAI,OAAO;QACxC;MACF,CAAC,CAAC,OAAOC,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,OAAO,EAAEA,KAAK,CAAC;QAC7B5B,QAAQ,CAACG,KAAK,GAAG,eAAe;MAClC;IACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}