{"ast":null,"code":"import { ref } from 'vue';\nimport { apiFetch, login } from '@/services/apiService.js';\nimport { useAuth } from '@/store/auth.js';\n\n// 定义要 emit (发出) 的事件\n\nexport default {\n  __name: 'AuthView',\n  emits: ['response'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const emit = __emit;\n    const {\n      saveToken\n    } = useAuth();\n\n    // 注册表单数据\n    const signupData = ref({\n      username: '',\n      password: '',\n      role: '',\n      phone: ''\n    });\n\n    // 登录表单数据\n    const loginData = ref({\n      username: '',\n      password: ''\n    });\n\n    // 处理注册\n    async function handleSignup() {\n      try {\n        const result = await apiFetch('/signup', {\n          method: 'POST',\n          body: JSON.stringify(signupData.value)\n        });\n        emit('response', result);\n        // 清空表单\n        signupData.value = {\n          username: '',\n          password: '',\n          role: '',\n          phone: ''\n        };\n      } catch (error) {\n        emit('response', {\n          code: 0,\n          msg: error.message,\n          data: null\n        });\n      }\n    }\n\n    // 处理登录\n    async function handleLogin() {\n      try {\n        // 使用特殊的 login 函数\n        const result = await login(loginData.value.username, loginData.value.password);\n\n        // 登录成功 (result.code === 1)，保存 token\n        saveToken(result.data);\n        emit('response', result);\n        // 清空表单\n        loginData.value = {\n          username: '',\n          password: ''\n        };\n      } catch (error) {\n        emit('response', {\n          code: 0,\n          msg: error.message,\n          data: null\n        });\n      }\n    }\n    const __returned__ = {\n      emit,\n      saveToken,\n      signupData,\n      loginData,\n      handleSignup,\n      handleLogin,\n      ref,\n      get apiFetch() {\n        return apiFetch;\n      },\n      get login() {\n        return login;\n      },\n      get useAuth() {\n        return useAuth;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","apiFetch","login","useAuth","emit","__emit","saveToken","signupData","username","password","role","phone","loginData","handleSignup","result","method","body","JSON","stringify","value","error","code","msg","message","data","handleLogin"],"sources":["G:/vue-project/jotang-frontend/src/views/AuthView.vue"],"sourcesContent":["<template>\r\n    <fieldset>\r\n        <legend>1. 认证 (Auth)</legend>\r\n        <div class=\"form-group\">\r\n            <h3>注册</h3>\r\n            <form @submit.prevent=\"handleSignup\">\r\n                <input type=\"text\" v-model=\"signupData.username\" placeholder=\"用户名\" required>\r\n                <input type=\"password\" v-model=\"signupData.password\" placeholder=\"密码\" required>\r\n                <input type=\"text\" v-model=\"signupData.role\" placeholder=\"角色 (e.g., buyer)\" required>\r\n                <input type=\"text\" v-model=\"signupData.phone\" placeholder=\"电话\" required>\r\n                <button type=\"submit\">注册</button>\r\n            </form>\r\n        </div>\r\n        <div class=\"form-group\">\r\n            <h3>登录</h3>\r\n            <form @submit.prevent=\"handleLogin\">\r\n                <input type=\"text\" v-model=\"loginData.username\" placeholder=\"用户名\" required>\r\n                <input type=\"password\" v-model=\"loginData.password\" placeholder=\"密码\" required>\r\n                <button type=\"submit\">登录</button>\r\n            </form>\r\n        </div>\r\n    </fieldset>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { apiFetch, login } from '@/services/apiService.js'\r\nimport { useAuth } from '@/store/auth.js'\r\n\r\n// 定义要 emit (发出) 的事件\r\nconst emit = defineEmits(['response'])\r\n\r\nconst { saveToken } = useAuth()\r\n\r\n// 注册表单数据\r\nconst signupData = ref({\r\n    username: '',\r\n    password: '',\r\n    role: '',\r\n    phone: ''\r\n})\r\n\r\n// 登录表单数据\r\nconst loginData = ref({\r\n    username: '',\r\n    password: ''\r\n})\r\n\r\n// 处理注册\r\nasync function handleSignup() {\r\n    try {\r\n        const result = await apiFetch('/signup', {\r\n            method: 'POST',\r\n            body: JSON.stringify(signupData.value),\r\n        })\r\n        emit('response', result)\r\n        // 清空表单\r\n        signupData.value = { username: '', password: '', role: '', phone: '' }\r\n    } catch (error) {\r\n        emit('response', { code: 0, msg: error.message, data: null })\r\n    }\r\n}\r\n\r\n// 处理登录\r\nasync function handleLogin() {\r\n    try {\r\n        // 使用特殊的 login 函数\r\n        const result = await login(loginData.value.username, loginData.value.password)\r\n        \r\n        // 登录成功 (result.code === 1)，保存 token\r\n        saveToken(result.data) \r\n        \r\n        emit('response', result)\r\n        // 清空表单\r\n        loginData.value = { username: '', password: '' }\r\n    } catch (error) {\r\n        emit('response', { code: 0, msg: error.message, data: null })\r\n    }\r\n}\r\n</script>"],"mappings":"AAyBA,SAASA,GAAG,QAAQ,KAAK;AACzB,SAASC,QAAQ,EAAEC,KAAK,QAAQ,0BAA0B;AAC1D,SAASC,OAAO,QAAQ,iBAAiB;;AAEzC;;;;;;;;;;IACA,MAAMC,IAAI,GAAGC,MAAyB;IAEtC,MAAM;MAAEC;IAAU,CAAC,GAAGH,OAAO,CAAC,CAAC;;IAE/B;IACA,MAAMI,UAAU,GAAGP,GAAG,CAAC;MACnBQ,QAAQ,EAAE,EAAE;MACZC,QAAQ,EAAE,EAAE;MACZC,IAAI,EAAE,EAAE;MACRC,KAAK,EAAE;IACX,CAAC,CAAC;;IAEF;IACA,MAAMC,SAAS,GAAGZ,GAAG,CAAC;MAClBQ,QAAQ,EAAE,EAAE;MACZC,QAAQ,EAAE;IACd,CAAC,CAAC;;IAEF;IACA,eAAeI,YAAYA,CAAA,EAAG;MAC1B,IAAI;QACA,MAAMC,MAAM,GAAG,MAAMb,QAAQ,CAAC,SAAS,EAAE;UACrCc,MAAM,EAAE,MAAM;UACdC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACX,UAAU,CAACY,KAAK;QACzC,CAAC,CAAC;QACFf,IAAI,CAAC,UAAU,EAAEU,MAAM,CAAC;QACxB;QACAP,UAAU,CAACY,KAAK,GAAG;UAAEX,QAAQ,EAAE,EAAE;UAAEC,QAAQ,EAAE,EAAE;UAAEC,IAAI,EAAE,EAAE;UAAEC,KAAK,EAAE;QAAG,CAAC;MAC1E,CAAC,CAAC,OAAOS,KAAK,EAAE;QACZhB,IAAI,CAAC,UAAU,EAAE;UAAEiB,IAAI,EAAE,CAAC;UAAEC,GAAG,EAAEF,KAAK,CAACG,OAAO;UAAEC,IAAI,EAAE;QAAK,CAAC,CAAC;MACjE;IACJ;;IAEA;IACA,eAAeC,WAAWA,CAAA,EAAG;MACzB,IAAI;QACA;QACA,MAAMX,MAAM,GAAG,MAAMZ,KAAK,CAACU,SAAS,CAACO,KAAK,CAACX,QAAQ,EAAEI,SAAS,CAACO,KAAK,CAACV,QAAQ,CAAC;;QAE9E;QACAH,SAAS,CAACQ,MAAM,CAACU,IAAI,CAAC;QAEtBpB,IAAI,CAAC,UAAU,EAAEU,MAAM,CAAC;QACxB;QACAF,SAAS,CAACO,KAAK,GAAG;UAAEX,QAAQ,EAAE,EAAE;UAAEC,QAAQ,EAAE;QAAG,CAAC;MACpD,CAAC,CAAC,OAAOW,KAAK,EAAE;QACZhB,IAAI,CAAC,UAAU,EAAE;UAAEiB,IAAI,EAAE,CAAC;UAAEC,GAAG,EAAEF,KAAK,CAACG,OAAO;UAAEC,IAAI,EAAE;QAAK,CAAC,CAAC;MACjE;IACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}