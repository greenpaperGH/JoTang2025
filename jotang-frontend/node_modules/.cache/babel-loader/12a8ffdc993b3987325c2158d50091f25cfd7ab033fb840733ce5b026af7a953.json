{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  key: 0,\n  style: {\n    \"color\": \"red\"\n  }\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", null, [_cache[5] || (_cache[5] = _createElementVNode(\"h2\", null, \"登录\", -1 /* CACHED */)), _createElementVNode(\"form\", {\n    onSubmit: _withModifiers($setup.handleLogin, [\"prevent\"])\n  }, [_createElementVNode(\"div\", null, [_cache[2] || (_cache[2] = _createElementVNode(\"label\", null, \"用户名: \", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.username = $event),\n    type: \"text\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.username]])]), _createElementVNode(\"div\", null, [_cache[3] || (_cache[3] = _createElementVNode(\"label\", null, \"密码: \", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.password = $event),\n    type: \"password\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.password]])]), _cache[4] || (_cache[4] = _createElementVNode(\"button\", {\n    type: \"submit\"\n  }, \"登录\", -1 /* CACHED */)), $setup.errorMsg ? (_openBlock(), _createElementBlock(\"p\", _hoisted_1, _toDisplayString($setup.errorMsg), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)], 32 /* NEED_HYDRATION */)]);\n}","map":{"version":3,"names":["style","_createElementBlock","_createElementVNode","onSubmit","_withModifiers","$setup","handleLogin","username","$event","type","required","password","errorMsg","_hoisted_1","_toDisplayString"],"sources":["G:\\vue-project\\jotang-frontend\\src\\views\\LoginView.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <h2>登录</h2>\r\n    <form @submit.prevent=\"handleLogin\">\r\n      <div>\r\n        <label>用户名: </label>\r\n        <input v-model=\"username\" type=\"text\" required />\r\n      </div>\r\n      <div>\r\n        <label>密码: </label>\r\n        <input v-model=\"password\" type=\"password\" required />\r\n      </div>\r\n      <button type=\"submit\">登录</button>\r\n      <p v-if=\"errorMsg\" style=\"color: red\">{{ errorMsg }}</p>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport { useRouter } from 'vue-router';\r\n\r\nconst username = ref('');\r\nconst password = ref('');\r\nconst errorMsg = ref('');\r\nconst router = useRouter();\r\nconst baseURL = 'http://localhost:8080';\r\n\r\nconst handleLogin = async () => {\r\n  try {\r\n    errorMsg.value = '';\r\n    //\r\n    // LoginController 需要 application/x-www-form-urlencoded 格式\r\n    const params = new URLSearchParams();\r\n    params.append('username', username.value);\r\n    params.append('password', password.value);\r\n\r\n    const response = await fetch(`${baseURL}/login`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: params\r\n    });\r\n\r\n    // fetch 不会自动抛出 HTTP 错误，需要手动检查\r\n    if (!response.ok) {\r\n      throw new Error(`HTTP error! status: ${response.status}`);\r\n    }\r\n\r\n    const result = await response.json(); //\r\n\r\n    if (result.code === 1) {\r\n      // 登录成功\r\n      const jwtToken = result.data;\r\n      localStorage.setItem('jwt-token', jwtToken);\r\n      // 跳转并刷新\r\n      router.push('/products').then(() => window.location.reload());\r\n    } else {\r\n      // 登录失败\r\n      errorMsg.value = result.msg || '登录失败。';\r\n    }\r\n  } catch (error) {\r\n    console.error('登录异常:', error);\r\n    errorMsg.value = '服务器连接失败或响应错误。';\r\n  }\r\n};\r\n</script>"],"mappings":";;;EAayBA,KAAkB,EAAlB;IAAA;EAAA;;;uBAZvBC,mBAAA,CAcM,c,0BAbJC,mBAAA,CAAW,YAAP,IAAE,qBACNA,mBAAA,CAWO;IAXAC,QAAM,EAAAC,cAAA,CAAUC,MAAA,CAAAC,WAAW;MAChCJ,mBAAA,CAGM,c,0BAFJA,mBAAA,CAAoB,eAAb,OAAK,qB,gBACZA,mBAAA,CAAiD;+DAAjCG,MAAA,CAAAE,QAAQ,GAAAC,MAAA;IAAEC,IAAI,EAAC,MAAM;IAACC,QAAQ,EAAR;iDAAtBL,MAAA,CAAAE,QAAQ,E,KAE1BL,mBAAA,CAGM,c,0BAFJA,mBAAA,CAAmB,eAAZ,MAAI,qB,gBACXA,mBAAA,CAAqD;+DAArCG,MAAA,CAAAM,QAAQ,GAAAH,MAAA;IAAEC,IAAI,EAAC,UAAU;IAACC,QAAQ,EAAR;iDAA1BL,MAAA,CAAAM,QAAQ,E,+BAE1BT,mBAAA,CAAiC;IAAzBO,IAAI,EAAC;EAAQ,GAAC,IAAE,qBACfJ,MAAA,CAAAO,QAAQ,I,cAAjBX,mBAAA,CAAwD,KAAxDY,UAAwD,EAAAC,gBAAA,CAAfT,MAAA,CAAAO,QAAQ,oB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}